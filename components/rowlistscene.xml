<?xml version = "1.0" encoding = "utf-8" ?> 

<!--********** Copyright 2016 Roku Corp.  All Rights Reserved. **********-->

<component name = "RowListExample" extends = "Scene" initialFocus = "exampleRowList" >

  <script type = "text/brightscript" >

    <![CDATA[

    sub init()

      rowlist = m.top.findNode("exampleRowList")
      rowlist.content = getContent()

      m.poster = m.top.findNode("topBackgroundPoster")
      m.detailPoster = m.top.findNode("detailBackgroundPoster")
      m.detailScreen = m.top.findNode("detailScreen")
      m.rect = m.top.findNode("rect")

      m.mainTitle = m.top.findNode("mainTitle")
      m.date = m.top.findNode("date")
      m.description = m.top.findNode("description")
      m.quality = m.top.findNode("quality")

      m.detailMainTitle = m.top.findNode("detailMainTitle")
      m.detailDuration = m.top.findNode("duration")
      m.detailDescription = m.top.findNode("detailDescription")

      rowList.observefield("rowItemFocused","onRowItemFocused")
      rowList.observeField("rowItemSelected","onRowItemSelected")
      m.top.setFocus(true)
    end sub

sub onRowItemFocused(msg as Object)
  row = msg.getData()[0]
  col = msg.getData()[1]
  m.poster.uri = m.obj.tvSpecials[row].thumbnail
      m.mainTitle.text = m.obj.tvSpecials[row].title
      m.date.text = m.obj.tvSpecials[row].content.dateAdded
      m.description.text = m.obj.tvSpecials[row].shortDescription
      m.quality.text = m.obj.tvSpecials[row].content.videos[col].quality
end sub

sub onRowItemSelected(msg as Object)
    print "row and col"
    row = msg.getData()[0]
    col = msg.getData()[1]
    print row
    print col

    m.detailPoster.uri = m.poster.uri

    m.detailMainTitle.text = m.obj.tvSpecials[row].title
    m.detailDuration.text = m.obj.tvSpecials[row].content.duration
    m.detailDescription.text =  m.obj.tvSpecials[row].shortDescription

    m.detailScreen.visible = true
    m.rect.visible = false
end sub      

    Function getContent()
      	filePath = "pkg:/components/Data/sample.json"
		    text = ReadAsciiFile(filePath) 
	    	m.obj = ParseJSON(text)

		    rootContentNode = CreateObject("roSGNode", "RowListContent")
		
      	for each item in m.obj.tvSpecials
          childNode = rootContentNode.CreateChild("ContentNode")
          childNode.title = item.title
			      for each video in item.content.videos
    					gChild = childNode.CreateChild("ContentNode")
				    	'gChild.posterUrl = video.Thumbnail
		    			gChild.title = video.Title
              gChild.HDPosterUrl = item.thumbnail
	        	end for
			end for
            
        return rootContentNode
      end Function

      function OnkeyEvent(key as String, press as Boolean) as Boolean
          print "onKeyEvent 1=>"
          print key
          result = false
          if (key = "back") and press = true
          m.rect.visible = true
          m.detailScreen.visible = false
          result = true
          end if
          return result
    end function
    ]]>

  </script>

  <children >

   <Rectangle 
        id = "rect" 
        color = "0x000000FF" 
        opacity = "0.55" 
        width = "1280" 
        height = "720" 
        scaleRotateCenter = "[ 256.0, 144.0 ]">

        <Label 
        id="mainTitle" 
        translation="[100,150]"
         width="700"
          wrap="true"
          horizAlign = "left"
          vertAlign = "top"
        height="50">
	    		<Font role="font" uri="pkg:/font/AvenirNextBold/AvenirNext-BoldItalic.ttf" size="30"/>
	    	</Label>


         <Label
        translation="[150, 200]" width="1000"
        id="date"
                  height="50"
                  vertAlign = "top"
        horizAlign = "left"
>
        	<Font role="font" uri="pkg:/font/AvenirNextBold/AvenirNext-BoldItalic.ttf" size="15"/>
	    	</Label>


         <Label
        translation="[100, 200]" width="1000"
        id="quality"
                  height="50"
                  vertAlign = "top"
        horizAlign = "left"
        >
        	<Font role="font" uri="pkg:/font/AvenirNextBold/AvenirNext-BoldItalic.ttf" size="15"/>
	    	</Label>


        <Label 
        id="description" 
        translation="[100,250]"
         width="600"
          height="100"
          horizAlign = "left"
          wrap="true" numLines="4"
          vertAlign = "top"
           lineSpacing="1"
         >
	    		<Font role="font" uri="pkg:/font/AvenirNextBold/AvenirNext-BoldItalic.ttf" size="20"/>
	    	</Label>

        <MaskGroup maskUri="pkg:/images/detailPageGradient.png" maskSize="[1280,720]" maskOffset="[300,0]">
	   			<Poster id="topBackgroundPoster"  width="1280" height="400" />
	    	</MaskGroup>

      <RowList 
        id = "exampleRowList"   
        translation = "[ 100, 340 ]" 
        itemComponentName = "RowListItem" 
        numRows = "2" 
        itemSize = "[ 1280, 208 ]" 
        rowItemSize = "[ [226, 148] ]" 
        itemSpacing = "[ 10, 10 ]" 
        showRowLabel = "[ true ]" 
        drawFocusFeedback = "true" 
        vertFocusAnimationStyle = "fixedFocusWrap" 
        rowFocusAnimationStyle = "fixedFocusWrap" />

    </Rectangle>
    <detailScreen id = "detailScreen" visible="false">

    </detailScreen>
  </children>

</component>
